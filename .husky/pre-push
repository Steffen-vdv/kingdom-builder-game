#!/usr/bin/env sh
# Pre-push hook - auto-formats, commits if needed, and runs quality checks

set -e

# Auto-fix formatting
npm run format

# If format changed files, commit them and ask user to push again
if ! git diff --quiet; then
    echo ""
    echo "ğŸ“ Formatting changed files - auto-committing..."
    git add -A
    git commit -m "chore: auto-format"

    # Run type checking and linting in parallel
    npx run-p typecheck lint

    echo ""
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "âœ… Auto-format commit created. Please push again!"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    exit 1
fi

# No formatting needed - just run checks and let original push proceed
npx run-p typecheck lint
