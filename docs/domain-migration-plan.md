# Domain Migration Plan

## Current Couplings

| Module                                                           | Engine Imports                                                         | Contents Imports                                                                                                                                                                                                        | Dependent Tests                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ---------------------------------------------------------------- | ---------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `src/Overview.tsx`                                               | —                                                                      | `OVERVIEW_CONTENT`<br>`OverviewTokenCandidates`                                                                                                                                                                         | `tests/Overview.test.tsx`<br>`tests/overview-content-source.test.tsx`                                                                                                                                                                                                                                                                                                                                                                           |
| `src/components/actions/GenericActionCard.tsx`                   | `ActionEffectGroup`<br>`ActionEffectGroupOption`                       | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/components/actions/RaisePopOptions.tsx`                     | —                                                                      | `PopulationRoleId`                                                                                                                                                                                                      | `tests/components/actions/RaisePopOptions.test.tsx`                                                                                                                                                                                                                                                                                                                                                                                             |
| `src/components/actions/populationHelpers.ts`                    | —                                                                      | `PopulationRoleId`                                                                                                                                                                                                      | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/components/actions/useEffectGroupOptions.ts`                | `ActionEffectGroup`<br>`ActionEffectGroupOption`                       | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/components/overview/overviewTokenUtils.ts`                  | —                                                                      | `OverviewTokenCategoryName`                                                                                                                                                                                             | `tests/overview-tokens.test.tsx`                                                                                                                                                                                                                                                                                                                                                                                                                |
| `src/components/overview/sectionsData.ts`                        | —                                                                      | `OverviewSectionTemplate`<br>`OverviewTokenCandidates`<br>`OverviewTokenCategoryName`                                                                                                                                   | `tests/Overview.test.tsx`                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `src/components/player/BuildingDisplay.tsx`                      | `PlayerStateSnapshot`                                                  | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/components/player/LandDisplay.tsx`                          | `PlayerStateSnapshot`                                                  | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/components/player/PassiveDisplay.tsx`                       | `EffectDef`<br>`PassiveSummary`<br>`PlayerId`<br>`PlayerStateSnapshot` | `PhaseId`                                                                                                                                                                                                               | `tests/passive-display.test.tsx`                                                                                                                                                                                                                                                                                                                                                                                                                |
| `src/components/player/PlayerPanel.tsx`                          | `PlayerStateSnapshot`                                                  | —                                                                                                                                                                                                                       | `tests/PlayerPanel.test.tsx`                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `src/components/player/PopulationInfo.tsx`                       | `PlayerStateSnapshot`                                                  | `Stat`                                                                                                                                                                                                                  | `tests/PopulationInfo.test.tsx`                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `src/components/player/ResourceBar.tsx`                          | `PlayerStateSnapshot`                                                  | —                                                                                                                                                                                                                       | `tests/resource-bar.test.tsx`                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `src/components/player/buildTierEntries.ts`                      | `RuleSnapshot`                                                         | —                                                                                                                                                                                                                       | `tests/passive-display.test.tsx`<br>`tests/resource-bar.test.tsx`                                                                                                                                                                                                                                                                                                                                                                               |
| `src/contexts/RegistryMetadataContext.tsx`                       | —                                                                      | `OVERVIEW_CONTENT`<br>`OverviewContentTemplate`                                                                                                                                                                         | `tests/ActionsPanel.test.tsx`<br>`tests/Overview.test.tsx`<br>`tests/PlayerPanel.test.tsx`<br>`tests/PopulationInfo.test.tsx`<br>`tests/components/actions/RaisePopOptions.test.tsx`<br>`tests/contexts/registryMetadataContext.test.tsx`<br>`tests/generic-actions-effect-group.test.tsx`<br>`tests/overview-content-source.test.tsx`<br>`tests/overview-tokens.test.tsx`<br>`tests/passive-display.test.tsx`<br>`tests/resource-bar.test.tsx` |
| `src/contexts/defaultRegistryMetadata.ts`                        | —                                                                      | `createActionRegistry`<br>`createBuildingRegistry`<br>`createDevelopmentRegistry`<br>`createPopulationRegistry`<br>`LAND_INFO`<br>`PASSIVE_INFO`<br>`PHASES`<br>`RESOURCES`<br>`SLOT_INFO`<br>`STATS`<br>`TRIGGER_INFO` | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/passives/visibility.ts`                                     | `PassiveSummary`                                                       | `POPULATIONS`                                                                                                                                                                                                           | `tests/passive-visibility.test.ts`                                                                                                                                                                                                                                                                                                                                                                                                              |
| `src/state/developerModeSetup.ts`                                | `EngineSession`<br>`PlayerId`                                          | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/state/formatPhaseResolution.ts`                             | `EngineAdvanceResult`                                                  | —                                                                                                                                                                                                                       | `tests/HoverCard.test.tsx`<br>`tests/state/formatPhaseResolution.integration.test.ts`<br>`tests/state/formatPhaseResolution.test.ts`                                                                                                                                                                                                                                                                                                            |
| `src/state/sessionSdk.ts`                                        | `ActionParams`<br>`createEngineSession`<br>`EngineSession`             | —                                                                                                                                                                                                                       | `tests/state/GameProvider.test.tsx`<br>`tests/state/sessionSdk.test.ts`<br>`tests/state/useActionPerformer.test.ts`<br>`tests/state/useAiRunner.test.ts`<br>`tests/state/usePhaseProgress.helpers.test.ts`<br>`tests/state/usePhaseProgress.test.ts`                                                                                                                                                                                            |
| `src/state/sessionSelectors.types.ts`                            | `PlayerStateSnapshot`                                                  | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/state/useActionResolution.ts`                               | `PlayerStateSnapshot`                                                  | —                                                                                                                                                                                                                       | `tests/HoverCard.test.tsx`<br>`tests/ResolutionCard.test.tsx`<br>`tests/state/GameProvider.test.tsx`<br>`tests/state/useActionResolution.test.ts`                                                                                                                                                                                                                                                                                               |
| `src/state/useAiRunner.ts`                                       | `ActionParams`                                                         | —                                                                                                                                                                                                                       | `tests/state/GameProvider.test.tsx`<br>`tests/state/useAiRunner.test.ts`                                                                                                                                                                                                                                                                                                                                                                        |
| `src/state/useNextTurnForecast.ts`                               | `PlayerSnapshotDeltaBucket`                                            | —                                                                                                                                                                                                                       | `tests/PlayerPanel.test.tsx`<br>`tests/PopulationInfo.test.tsx`<br>`tests/useNextTurnForecast.test.ts`                                                                                                                                                                                                                                                                                                                                          |
| `src/state/usePhaseProgress.helpers.ts`                          | `EngineAdvanceResult`                                                  | —                                                                                                                                                                                                                       | `tests/state/usePhaseProgress.helpers.test.ts`<br>`tests/state/usePhaseProgress.test.ts`                                                                                                                                                                                                                                                                                                                                                        |
| `src/translation/content/phased.ts`                              | —                                                                      | `TRIGGER_INFO`                                                                                                                                                                                                          | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/content/population.ts`                          | —                                                                      | `PopulationRoleId`                                                                                                                                                                                                      | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/context/assetSelectors.ts`                      | —                                                                      | `TRIGGER_INFO`                                                                                                                                                                                                          | `tests/attack-on-damage-registry.test.ts`<br>`tests/development-summary.test.ts`<br>`tests/development-translation.test.ts`                                                                                                                                                                                                                                                                                                                     |
| `src/translation/context/assets.ts`                              | —                                                                      | `TRIGGER_INFO`                                                                                                                                                                                                          | `tests/helpers/playerPanelFixtures.ts`<br>`tests/helpers/translationAssets.ts`                                                                                                                                                                                                                                                                                                                                                                  |
| `src/translation/effects/evaluators/population.ts`               | —                                                                      | `PopulationRoleId`                                                                                                                                                                                                      | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/effects/formatters/attack/registrySelectors.ts` | —                                                                      | `BUILDINGS`<br>`ResourceKey`<br>`RESOURCES`<br>`StatKey`<br>`STATS`                                                                                                                                                     | `tests/army-attack-translation.log.test.ts`<br>`tests/army-attack-translation.summary.test.ts`<br>`tests/attack-diff-formatters.test.ts`<br>`tests/helpers/armyAttackFactories.ts`<br>`tests/raiders-guild-translation.test.ts`                                                                                                                                                                                                                 |
| `src/translation/effects/formatters/attack/resource.ts`          | —                                                                      | `Resource`<br>`ResourceKey`                                                                                                                                                                                             | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/effects/formatters/attack/stat.ts`              | —                                                                      | `StatKey`                                                                                                                                                                                                               | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/effects/formatters/attack/statContext.ts`       | —                                                                      | `Stat`<br>`StatKey`                                                                                                                                                                                                     | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/effects/formatters/attack/types.ts`             | —                                                                      | `ResourceKey`<br>`StatKey`                                                                                                                                                                                              | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/effects/formatters/attack.ts`                   | —                                                                      | `ResourceKey`                                                                                                                                                                                                           | `tests/army-attack-translation.log.test.ts`<br>`tests/army-attack-translation.summary.test.ts`<br>`tests/attack-diff-formatters.test.ts`<br>`tests/attack-on-damage-registry.test.ts`<br>`tests/helpers/armyAttackFactories.ts`<br>`tests/raiders-guild-translation.test.ts`                                                                                                                                                                    |
| `src/translation/effects/formatters/attackFormatterUtils.ts`     | —                                                                      | `ResourceKey`                                                                                                                                                                                                           | `tests/attack-on-damage-registry.test.ts`                                                                                                                                                                                                                                                                                                                                                                                                       |
| `src/translation/effects/formatters/land.ts`                     | —                                                                      | `LAND_INFO`<br>`SLOT_INFO`                                                                                                                                                                                              | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/effects/formatters/modifier.ts`                 | —                                                                      | `RESOURCE_TRANSFER_ICON`                                                                                                                                                                                                | `tests/hold-festival-action-translation.test.ts`<br>`tests/modifier-eval-handlers.test.ts`<br>`tests/raiders-guild-translation.test.ts`                                                                                                                                                                                                                                                                                                         |
| `src/translation/effects/formatters/modifier_helpers.ts`         | —                                                                      | `DevelopmentDef`                                                                                                                                                                                                        | `tests/hold-festival-action-translation.test.ts`<br>`tests/raiders-guild-translation.test.ts`                                                                                                                                                                                                                                                                                                                                                   |
| `src/translation/effects/formatters/modifier_targets.ts`         | —                                                                      | `ActionDef`                                                                                                                                                                                                             | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/effects/formatters/population.ts`               | —                                                                      | `PopulationRoleId`                                                                                                                                                                                                      | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/translation/effects/helpers.ts`                             | —                                                                      | `PopulationRoleId`                                                                                                                                                                                                      | `tests/raiders-guild-translation.test.ts`                                                                                                                                                                                                                                                                                                                                                                                                       |
| `src/translation/effects/registrySelectors.ts`                   | —                                                                      | `PopulationRoleId`<br>`StatKey`<br>`STATS`                                                                                                                                                                              | `tests/append-stat-changes.test.ts`<br>`tests/log-source-icons.test.ts`<br>`tests/modifier-eval-handlers.test.ts`<br>`tests/passive-log-labels.test.ts`                                                                                                                                                                                                                                                                                         |
| `src/utils/describeSkipEvent.ts`                                 | `AdvanceSkip`                                                          | —                                                                                                                                                                                                                       | `tests/describe-skip-event.test.ts`<br>`tests/state/formatPhaseResolution.test.ts`                                                                                                                                                                                                                                                                                                                                                              |
| `src/utils/getRequirementIcons.ts`                               | —                                                                      | `POPULATION_ROLES`<br>`PopulationRoleId`<br>`StatKey`<br>`STATS`                                                                                                                                                        | `tests/ActionsPanel.test.tsx`<br>`tests/generic-actions-effect-group.test.tsx`<br>`tests/getRequirementIcons.test.ts`                                                                                                                                                                                                                                                                                                                           |
| `src/utils/stats/dependencyFormatters.ts`                        | `PlayerStateSnapshot`<br>`StatSourceLink`<br>`StatSourceMeta`          | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/utils/stats/descriptorRegistry.ts`                          | —                                                                      | `PASSIVE_INFO`<br>`POPULATION_ROLES`<br>`RESOURCES`<br>`STATS`                                                                                                                                                          | `tests/attack-on-damage-registry.test.ts`<br>`tests/stat-breakdown.test.ts`<br>`tests/stat-descriptor-registry.test.ts`                                                                                                                                                                                                                                                                                                                         |
| `src/utils/stats/format.ts`                                      | —                                                                      | `STATS`                                                                                                                                                                                                                 | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/utils/stats/historyEntries.ts`                              | `StatSourceMeta`                                                       | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/utils/stats/passiveFormatting.ts`                           | `StatSourceLink`<br>`StatSourceMeta`                                   | `formatPassiveRemoval`<br>`PASSIVE_INFO`<br>`PhaseStepId`                                                                                                                                                               | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/utils/stats/summary.ts`                                     | `PlayerStateSnapshot`<br>`StatSourceMeta`                              | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/utils/stats/triggerLabels.ts`                               | —                                                                      | `TRIGGER_INFO`                                                                                                                                                                                                          | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/utils/stats/types.ts`                                       | `PlayerStateSnapshot`<br>`StatSourceLink`                              | —                                                                                                                                                                                                                       | —                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `src/utils/stats.ts`                                             | `PlayerStateSnapshot`<br>`StatKey`<br>`StatSourceContribution`         | `STATS`                                                                                                                                                                                                                 | `tests/PlayerPanel.test.tsx`<br>`tests/append-stat-changes.test.ts`<br>`tests/attack-on-damage-registry.test.ts`<br>`tests/modifier-percent-formatting.test.ts`<br>`tests/stat-breakdown.test.ts`<br>`tests/stat-descriptor-registry.test.ts`                                                                                                                                                                                                   |
